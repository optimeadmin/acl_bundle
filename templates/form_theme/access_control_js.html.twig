<script>
    if (!(typeof window.jQuery == 'undefined')) {
        jQuery(function ($) {
            $(".js-acl-select-all-roles :checkbox").each(function () {
                $(this).addClass('js-select-all-roles-checkbox');
            });

            // $(".acl-resource-container[data-parent]").each(function () {
            //     const name = $(this).data('parent');
            //
            //     if (0 === $(".acl-resource-container[data-resource='" + name + "']").length) {
            //         return;
            //     }
            //
            //     $(this).addClass('acl-resource-child');
            // });

            $(".js-acl-select-all-roles :checkbox").on('change', function (event, trigger = true) {
                const $this = $(this);
                const $roles = $this.closest('.acl-resource-container').find(':checkbox').not(this);

                if (trigger) {
                    $roles.prop('checked', $this.is(':checked')).trigger('change');
                }
            });

            $(".acl-resource-container :checkbox").on('change', function (event, trigger = true) {
                const $this = $(this);
                const $container = $this.closest('.acl-resource-container');

                if (!$this.is('.js-select-all-roles-checkbox') && !$this.is(':checked')) {
                    $container.find(':checkbox.js-select-all-roles-checkbox').prop('checked', false);
                }

                if (!$container.is('[data-parent]') || !$container.data('parent')) {
                    return;
                }

                const parentResourceName = $container.data('parent');
                const $parent = $(".acl-resource-container[data-resource='" + parentResourceName + "']");

                if ($parent.length === 0) {
                    return;
                }

                const $parentCheckbox = $parent.find(':checkbox[value="' + $this.val() + '"]');

                if (!$parentCheckbox) {
                    return;
                }

                const $childCheckboxes = $(".acl-resource-container[data-parent='" + parentResourceName + "']")
                    .find(':checkbox[value="' + $this.val() + '"]');

                $parentCheckbox.prop('disabled', $childCheckboxes.is(':checked'));

                if (trigger) {
                    $parentCheckbox
                        .prop('checked', $childCheckboxes.is(':checked'))
                        .trigger('change');
                }

            });

            $(".acl-resource-container:first").each(function () {
                $(this).closest('form').on('submit', function () {
                    $(this).find(':checkbox').prop('disabled', false);
                });
            });

            $(".acl-resource-container :checkbox").trigger('change', [false]);
        });
    }
</script>